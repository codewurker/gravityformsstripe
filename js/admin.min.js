!function(e){var t={};function i(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([,function(e,t){var i,n;window.GFStripeAdmin=null,i=jQuery,n=function(){var e=this;this.accountSettingsLocked=!1,this.deauthActionable=!1,this.inputContainerPrefix=gforms_stripe_admin_strings.input_container_prefix,this.inputPrefix=gforms_stripe_admin_strings.input_prefix,this.liveDependencySupported=gforms_stripe_admin_strings.liveDependencySupported,this.apiMode=gforms_stripe_admin_strings.apiMode,this.init=function(){this.initKeyStatus("live_publishable_key"),this.initKeyStatus("live_secret_key"),this.initKeyStatus("test_publishable_key"),this.initKeyStatus("test_secret_key"),this.bindDeauthorize(),this.liveDependencySupported||this.bindAPIModeChange(),this.maybeLockAccountSettings(),this.bindWebhookAlert(),this.bindRefund(),this.bindCapture()},this.validateKey=function(e,t){0!=t.length?(i("#"+e).val(t.trim()),this.setKeyStatusIcon(e,"<img src='"+gforms_stripe_admin_strings.spinner+"'/>"),"live_publishable_key"==e||"test_publishable_key"==e?this.validatePublishableKey(e,t):this.validateSecretKey(e,t)):this.setKeyStatus(e,"")},this.validateSecretKey=function(t,n){i.post(ajaxurl,{action:"gf_validate_secret_key",keyName:t,key:n,nonce:gforms_stripe_admin_strings.ajax_nonce},(function(i){"valid"==(i=i.trim())?e.setKeyStatus(t,"1"):"invalid"==i?e.setKeyStatus(t,"0"):e.setKeyStatusIcon(t,gforms_stripe_admin_strings.validation_error)}))},this.validatePublishableKey=function(t,i){this.setKeyStatusIcon(t,"<img src='"+gforms_stripe_admin_strings.spinner+"'/>"),cc={number:"4916433572511762",exp_month:"01",exp_year:(new Date).getFullYear()+1,cvc:"111",name:"Test Card"},Stripe.setPublishableKey(i),Stripe.card.createToken(cc,(function(i,n){200==i?e.setKeyStatus(t,"1"):400!=i&&402!=i||"live_publishable_key"!=t?e.setKeyStatus(t,"0"):e.setKeyStatus(t,"1")}))},this.initKeyStatus=function(e){var t=i("#"+e+"_is_valid"),n=i("#"+e);t.length>0?this.setKeyStatus(e,t.val()):n.length>0&&this.validateKey(e,n.val())},this.setKeyStatus=function(e,t){i("#"+e+"_is_valid").val(t);var n="";"1"==t?n='<i class="fa icon-check fa-check gf_valid"></i>':"0"==t&&(n='<i class="fa icon-remove fa-times gf_invalid"></i>'),this.setKeyStatusIcon(e,n)},this.setKeyStatusIcon=function(e,t){var n=i("#"+e+"_status_icon");n.length>0&&n.remove(),i("#"+e).after("<span id='"+e+"_status_icon'>&nbsp;&nbsp;"+t+"</span>")},this.bindDeauthorize=function(){i(".gform_stripe_deauth_button").on("click",(function(t){if(t.preventDefault(),e.accountSettingsLocked)return window.location.reload(),!1;var n=i("#gform_stripe_deauth_button"),a=i("#deauth_scope"),s=gforms_stripe_admin_strings.disconnect,r=i(this).data("mode"),o=i(this).data("fid");if(e.deauthActionable){var d=i("#"+r+"_deauth_scope0").is(":checked")?"site":"account",c="site"===d&&""!==o?s.feed:s[d];if(!confirm(c))return!1;n.attr("disabled","disabled"),i.ajax({async:!1,url:ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_deauthorize",scope:d,fid:o,id:i(this).data("id"),mode:r,nonce:gforms_stripe_admin_strings.ajax_nonce},success:function(e){e.success?window.location.reload():alert(e.data.message),n.removeAttr("disabled")}})}else i(".gform_stripe_deauth_button").eq(0).hide(),""!==o&&i(".connected_to_stripe_text").hide(),a.show(0,(function(){e.deauthActionable=!0}))}))},this.bindAPIModeChange=function(){""!==this.apiMode&&void 0!==this.apiMode||(this.apiMode="live",i("#api_mode0").prop("checked",!0));var t="live"===this.apiMode?"test":"live";i("#"+this.inputContainerPrefix+this.apiMode+"_auth_token").show(),i("#"+this.inputContainerPrefix+t+"_auth_token").hide(),i('#tab_gravityformsstripe input[name="'+this.inputPrefix+'_api_mode"]').on("click",(function(n){e.apiMode=i(this).val(),t="live"===e.apiMode?"test":"live",i("#"+e.inputContainerPrefix+t+"_auth_token").hide(),i("#"+e.inputContainerPrefix+e.apiMode+"_auth_token").show()}))},this.maybeLockAccountSettings=function(){i("#"+this.inputContainerPrefix+"connected_to").siblings("#"+this.inputContainerPrefix+"api_mode, #"+this.inputContainerPrefix+"live_auth_token, #"+this.inputContainerPrefix+"test_auth_token").hide(),i("#gform_stripe_change_account").on("click",(function(){if(i(this).data("disabled"))alert(gforms_stripe_admin_strings.switch_account_disabled_message);else{i("#"+e.inputContainerPrefix+"api_mode").show();var t="live"===e.apiMode?"test":"live";i("#"+e.inputContainerPrefix+t+"_auth_token").hide(),i("#"+e.inputContainerPrefix+e.apiMode+"_auth_token").show(),i(this).off("click").addClass("disabled")}})),i("table.gforms_form_settings").on("change","input, select",(function(){var t=i(this).attr("name");t!==e.inputPrefix+"_api_mode"&&"deauth_scope"!==t&&t!==e.inputPrefix+"_transactionType"&&(e.accountSettingsLocked=!0)})),i("#gform-settings-save").on("click",(function(){i(".error.below-h2").remove(),e.accountSettingsLocked=!1})),window.addEventListener("beforeunload",(function(t){e.accountSettingsLocked&&(t.preventDefault(),t.returnValue="")}))},this.bindWebhookAlert=function(){i("#gform_stripe_change_account").length&&""===i("#"+this.apiMode+"_signing_secret").val()&&(i("#webhooks_enabled").focus(),i([document.documentElement,document.body]).animate({scrollTop:i("#"+e.inputContainerPrefix+"api_mode").offset().top+20},1e3))},this.bindRefund=function(){i(".stripe-refund").on("click",(function(e){e.preventDefault();var t=i(".stripe_refund"),n=i("#refund_wait_container"),a=i(this).data("tid");if(entryId=i(this).data("lid"),!window.confirm(gforms_stripe_admin_strings.refund))return!1;t.prop("disabled",!0),n.fadeIn(),wp.a11y.speak(gforms_stripe_admin_strings.refund_processing,"assertive"),i.ajax({async:!0,url:ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_refund",transaction_id:a,entry_id:entryId,nonce:gforms_stripe_admin_strings.refund_nonce},success:function(e){e.success?window.location.reload():(wp.a11y.speak(e.data.message,"assertive"),i(".gform_stripe_refund_alert").show().html(e.data.message))},complete:function(){wp.a11y.speak(gforms_stripe_admin_strings.refund_complete,"assertive"),t.prop("disabled",!1),n.hide()}}).fail((function(e,i,a){window.alert(a),t.prop("disabled",!1),n.hide()}))}))},this.bindCapture=function(){i(".stripe-capture").on("click keypress",(function(e){e.preventDefault();var t=i(".stripe-capture"),n=i("#capture_wait_container");if(errorContainer=i(".gform_stripe_capture_alert"),!window.confirm(gforms_stripe_admin_strings.capture_confirm))return!1;n.fadeIn(),t.prop("disabled",!0),errorContainer.hide(),wp.a11y.speak(gforms_stripe_admin_strings.capture_processing,"assertive");var a=t.data("ajax");i.ajax({url:ajaxurl,method:"POST",data:{action:"gfstripe_capture_action",transaction_id:a.transaction_id,entry_id:a.entry_id,nonce:a.nonce},success:function(e){e.success?(wp.a11y.speak(gforms_stripe_admin_strings.capture_complete,"assertive"),window.location.reload()):(wp.a11y.speak(e.data,"assertive"),errorContainer.show().html(e.data),t.prop("disabled",!1),n.hide())}}).fail((function(e,i,a){wp.a11y.speak(a,"assertive"),errorContainer.show().html(a),t.prop("disabled",!1),n.hide()}))}))},this.init()},i(document).ready((function(){GFStripeAdmin=new n}))}]);