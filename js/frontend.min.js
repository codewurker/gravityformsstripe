!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";r.r(t),r.d(t,"Headers",(function(){return h})),r.d(t,"Request",(function(){return w})),r.d(t,"Response",(function(){return F})),r.d(t,"DOMException",(function(){return O})),r.d(t,"fetch",(function(){return C}));var i="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==i&&i,n="URLSearchParams"in i,s="Symbol"in i&&"iterator"in Symbol,a="FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in i,d="ArrayBuffer"in i;if(d)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],p=ArrayBuffer.isView||function(e){return e&&l.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function f(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function _(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function g(e){var t=new FileReader,r=m(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:a&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():d&&a&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):d&&(ArrayBuffer.prototype.isPrototypeOf(e)||p(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=_(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=_(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(g)}),this.text=function(){var e,t,r,i=_(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=m(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),i=0;i<t.length;i++)r[i]=String.fromCharCode(t[i]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=c(e),t=u(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[c(e)]},h.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},h.prototype.set=function(e,t){this.map[c(e)]=u(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),f(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),f(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),f(e)},s&&(h.prototype[Symbol.iterator]=h.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(e,t){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,i,n=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(r=t.method||this.method||"GET",i=r.toUpperCase(),v.indexOf(i)>-1?i:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function S(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),i=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(n))}})),t}function F(e,t){if(!(this instanceof F))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(F.prototype),F.prototype.clone=function(){return new F(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},F.error=function(){var e=new F(null,{status:0,statusText:""});return e.type="error",e};var j=[301,302,303,307,308];F.redirect=function(e,t){if(-1===j.indexOf(t))throw new RangeError("Invalid status code");return new F(null,{status:t,headers:{location:e}})};var O=i.DOMException;try{new O}catch(e){(O=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),O.prototype.constructor=O}function C(e,t){return new Promise((function(r,n){var s=new w(e,t);if(s.signal&&s.signal.aborted)return n(new O("Aborted","AbortError"));var o=new XMLHttpRequest;function l(){o.abort()}o.onload=function(){var e,t,i={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),i=r.shift().trim();if(i){var n=r.join(":").trim();t.append(i,n)}})),t)};i.url="responseURL"in o?o.responseURL:i.headers.get("X-Request-URL");var n="response"in o?o.response:o.responseText;setTimeout((function(){r(new F(n,i))}),0)},o.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){n(new O("Aborted","AbortError"))}),0)},o.open(s.method,function(e){try{return""===e&&i.location.href?i.location.href:e}catch(t){return e}}(s.url),!0),"include"===s.credentials?o.withCredentials=!0:"omit"===s.credentials&&(o.withCredentials=!1),"responseType"in o&&(a?o.responseType="blob":d&&s.headers.get("Content-Type")&&-1!==s.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof h?s.headers.forEach((function(e,t){o.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){o.setRequestHeader(e,u(t.headers[e]))})),s.signal&&(s.signal.addEventListener("abort",l),o.onreadystatechange=function(){4===o.readyState&&s.signal.removeEventListener("abort",l)}),o.send(void 0===s._bodyInit?null:s._bodyInit)}))}C.polyfill=!0,i.fetch||(i.fetch=C,i.Headers=h,i.Request=w,i.Response=F)},,function(e,t,r){r(0),e.exports=r(5)},,,function(e,t,r){"use strict";r.r(t);var i,n=async(e,t=!1,r=!1,i=!1)=>{"function"==typeof e.has&&e.has("gform_ajax")&&(e.set("gform_ajax--stripe-temp",e.get("gform_ajax")),e.delete("gform_ajax"));const n={method:"POST",credentials:"same-origin",body:e};t&&(n.headers={Accept:"application/json","content-type":"application/json"});const s=new URL(gforms_stripe_frontend_strings.ajaxurl);return r&&s.searchParams.set("action",r),i&&s.searchParams.set("nonce",i),gforms_stripe_frontend_strings.is_preview&&s.searchParams.set("preview","1"),await fetch(s.toString(),n).then(e=>e.json())},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};class a{constructor(e,t){if(this.GFStripeObj=t,this.apiKey=e,this.stripe=null,this.elements=null,this.card=null,this.paymentMethod=null,this.draftId=null,this.validateForm=this.validate.bind(this),this.handlelinkEmailFieldChange=this.reInitiateLinkWithEmailAddress.bind(this),this.order={recurringAmount:0,paymentAmount:0},this.clearErrors(),this.initStripe()&&"1"===gforms_stripe_frontend_strings.stripe_connect_enabled){if(this.card=this.elements.create("payment"),t.activeFeed.link_email_field_id){const e=document.querySelector("#input_"+this.GFStripeObj.formId+"_"+this.GFStripeObj.activeFeed.link_email_field_id),t=e?e.value:"";this.handlelinkEmailFieldChange({target:{value:t}})}else this.link=null;this.mountCard(),this.bindEvents()}}getStripeCoupon(){const e=window.stripeCoupons||{},t=this.getStripeCouponCode(),r=Object.keys(e).find(e=>0===e.localeCompare(t,void 0,{sensitivity:"accent"}));return r?e[r]:void 0}getStripeCouponInput(){const e=document.querySelector("#field_"+this.GFStripeObj.formId+"_"+this.GFStripeObj.activeFeed.coupon);return e?e.querySelector("input"):null}getStripeCouponCode(){const e=this.getStripeCouponInput();if(!e)return"";if("gf_coupon_code"===e.className){return e?document.querySelector("#gf_coupon_codes_"+this.GFStripeObj.formId).value:null}return e?e.value:""}bindStripeCoupon(){const e=this.getStripeCouponInput();e&&!e.getAttribute("data-listener-added")&&(e.addEventListener("blur",this.handleCouponChange.bind(this)),e.setAttribute("data-listener-added",!0))}async handleCouponChange(e){this.getStripeCouponInput()===e.target&&(e.target.classList.contains("gf_coupon_code")&&(e.target.value=e.target.value.toUpperCase()),await this.updateStripeCoupon(e.target.value),gformCalculateTotalPrice(this.GFStripeObj.formId))}async updateStripeCoupon(e){if(!e)return;if(window.stripeCoupons||(window.stripeCoupons={}),window.stripeCoupons[e])return;const t=await n(JSON.stringify({coupon:e,feed_id:this.GFStripeObj.activeFeed.feedId}),!0,"gfstripe_get_stripe_coupon",gforms_stripe_frontend_strings.get_stripe_coupon_nonce);window.stripeCoupons[e]=t.data}async initStripe(){this.stripe=Stripe(this.apiKey);const e=this.GFStripeObj.activeFeed.initial_payment_information,t=this.GFStripeObj.cardStyle;return"payment_method_types"in e&&(e.payment_method_types=Object.values(e.payment_method_types)),this.elements=this.stripe.elements(s({},e,{appearance:t})),!0}mountCard(){this.card.mount("#"+this.GFStripeObj.GFCCField.attr("id"))}mountLink(){if(null!==this.link){if(document.querySelectorAll(".stripe-payment-link").length<=0){const e=document.createElement("div");e.setAttribute("id","stripe-payment-link"),e.classList.add("StripeElement--link"),this.GFStripeObj.GFCCField.before(jQuery(e))}this.link.mount("#stripe-payment-link")}}async bindEvents(){this.card&&this.card.on("change",e=>{null!==this.paymentMethod&&this.clearErrors(),this.paymentMethod=e}),this.bindStripeCoupon();const e=document.querySelector("#input_"+this.GFStripeObj.formId+"_"+this.GFStripeObj.activeFeed.link_email_field_id);null!==e&&(e.addEventListener("blur",this.handlelinkEmailFieldChange),window.addEventListener("load",async function(){const e=document.querySelector("#input_"+this.GFStripeObj.formId+"_"+this.GFStripeObj.activeFeed.link_email_field_id);String(e.value).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)&&this.GFStripeObj.isLastPage()&&this.handlelinkEmailFieldChange({target:{value:e.value}})}.bind(this)))}async reInitiateLinkWithEmailAddress(e){if(!1===this.GFStripeObj.isCreditCardOnPage())return;this.destroyLink();const t=e.target.value;t&&(this.link=await this.elements.create("linkAuthentication",{defaultValues:{email:t}}),this.mountLink(),this.GFStripeObj.GFCCField.siblings(".gfield #stripe-payment-link").addClass("visible"))}async validate(e){const t=jQuery("#gform_"+this.GFStripeObj.formId);if(t.data("isAjaxSubmitting"))return void t.submit();if(!this.paymentMethod.complete&&"link"!==this.paymentMethod.value.type)return this.failWithMessage(gforms_stripe_frontend_strings.payment_incomplete,this.GFStripeObj.formId),!1;gformAddSpinner(this.GFStripeObj.formId);const r=await n(this.getFormData(e.target));if(-1===r)return this.failWithMessage(gforms_stripe_frontend_strings.invalid_nonce,this.GFStripeObj.formId),!1;if("success"in r&&!1===r.success)return this.failWithMessage(gforms_stripe_frontend_strings.failed_to_confirm_intent,this.GFStripeObj.formId),!1;if("invoice_id"in r.data&&null!==r.data.invoice_id&&"resume_token"in r.data){const e=new URL(window.location.href);e.searchParams.append("resume_token",r.data.resume_token),window.location.href=e.href}const i="intent"in r.data&&!1!==r.data.intent&&null!=r.data.intent&&"client_secret"in r.data.intent,s="data"in r&&"is_valid"in r.data&&r.data.is_valid&&"resume_token"in r.data,a="is_spam"in r.data&&r.data.is_spam;if(!i&&!a&&s)return this.failWithMessage(gforms_stripe_frontend_strings.failed_to_confirm_intent,this.GFStripeObj.formId),!1;if(s){if(this.resetFormValidationErrors(),this.draftId=r.data.resume_token,"1"!==this.GFStripeObj.activeFeed.hasTrial&&!this.GFStripeObj.activeFeed.setupFee&&!this.isValidCoupon(r.data.total))return this.failWithMessage(gforms_stripe_frontend_strings.coupon_invalid,this.GFStripeObj.formId),!1;a?this.handleRedirect(this.getRedirectUrl(r.data.resume_token)):this.confirm(r.data)}else e.target.submit()}isValidCoupon(e){const t=this.getStripeCoupon();return!t||t.is_valid&&e==this.order.paymentAmount}getFormData(e){const t=new FormData(e);t.delete("gform_submit");const r={action:"gfstripe_validate_form",feed_id:this.GFStripeObj.activeFeed.feedId,form_id:this.GFStripeObj.formId,payment_method:this.paymentMethod.value.type,nonce:gforms_stripe_frontend_strings.validate_form_nonce};return Object.keys(r).forEach(e=>{t.append(e,r[e])}),t}updatePaymentAmount(e){if(e<=0||"setup"===this.GFStripeObj.activeFeed.initial_payment_information.mode)return;let t=100*e;t=Math.round(100*t)/100,this.elements.update({amount:t})}applyStripeCoupon(e){const t=this.getStripeCoupon();return t&&t.is_valid?(t.percentage_off?e-=e*(t.percentage_off/100):t.amount_off&&(e-=t.amount_off),e):e}async confirm(e){const t=this.getRedirectUrl(e.resume_token),{error:r}=await this.elements.submit();if(r)return void this.failWithMessage(r.message,this.GFStripeObj.formId);const i={elements:this.elements,clientSecret:e.intent.client_secret,confirmParams:{return_url:t.toString(),payment_method_data:{billing_details:{address:{line1:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_line1)),line2:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_line2)),city:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_city)),state:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_state)),postal_code:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_zip))}}}},redirect:"if_required"};let n={},s=0===e.intent.id.indexOf("seti_");try{n=s?await this.stripe.confirmSetup(i):await this.stripe.confirmPayment(i)}catch(e){console.log(e),this.failWithMessage(gforms_stripe_frontend_strings.failed_to_confirm_intent,this.GFStripeObj.formId)}"paymentIntent"in n||"setupIntent"in n?this.handlePaymentRedirect(n,t):await this.handleFailedPayment(n)}handlePaymentRedirect(e,t){const r=e.paymentIntent?e.paymentIntent:e.setupIntent,i=0===r.id.indexOf("seti_")?"setup":"payment";t.searchParams.append(i+"_intent",r.id),t.searchParams.append(i+"_intent_client_secret",r.client_secret),t.searchParams.append("redirect_status",r.status?"succeeded":"pending"),this.handleRedirect(t)}handleRedirect(e){this.isAjaxEmbed(this.GFStripeObj.formId)?(jQuery("#gform_"+this.GFStripeObj.formId).attr("action",e.toString()),jQuery("#gform_"+this.GFStripeObj.formId).data("isAjaxSubmitting",!0),jQuery("#gform_"+this.GFStripeObj.formId).find('[name="gform_submit"]').remove(),jQuery("#gform_"+this.GFStripeObj.formId).submit()):window.location.href=e.toString()}getRedirectUrl(e){const t=new URL(window.location.href);return t.searchParams.append("resume_token",e),t}async handleFailedPayment(e){let t="";"error"in e&&"message"in e.error&&(t=e.error.message),this.failWithMessage(t,this.GFStripeObj.formId);let r=n(JSON.stringify({draft_id:this.draftId}),!0,"gfstripe_delete_draft_entry",gforms_stripe_frontend_strings.delete_draft_nonce);this.GFStripeObj.hasOwnProperty("cardErrorCount")&&(r=await n(JSON.stringify({increase_count:!0}),!0,"gfstripe_payment_element_check_rate_limiting",gforms_stripe_frontend_strings.rate_limiting_nonce),this.GFStripeObj.cardErrorCount=r.data.error_count)}destroy(){this.card&&this.card.destroy(),this.destroyLink()}destroyLink(){if(this.link){this.link.destroy(),this.link=null;const e=this.GFStripeObj.GFCCField.siblings(".gfield #stripe-payment-link");e&&e.remove()}}clearErrors(){this.GFStripeObj.GFCCField.next(".validation_message").length&&this.GFStripeObj.GFCCField.next(".validation_message").remove()}resetFormValidationErrors(){document.querySelectorAll(".gform_validation_errors, .validation_message").forEach(e=>{e.remove()}),document.querySelectorAll(".gfield_error").forEach(e=>{e.classList.remove("gfield_error")})}failWithMessage(e,t){e=e||gforms_stripe_frontend_strings.failed_to_process_payment,this.GFStripeObj.displayStripeCardError({error:{message:e}}),this.GFStripeObj.resetStripeStatus(jQuery("#gform_"+t),t,!0),jQuery("#gform_ajax_spinner_"+t).remove()}getBillingAddressMergeTag(e){return""===e?"":"{:"+e+":value}"}getOrderData(e,t){if(!_gformPriceFields[t]||null===this.GFStripeObj.activeFeed)return this.order;const r=this.GFStripeObj.activeFeed.setupFee;let i=0;const n=this.GFStripeObj.activeFeed.hasTrial;if(r){const r=this.GFStripeObj.getProductFieldPrice(t,this.GFStripeObj.activeFeed.setupFee);i=r.price*r.qty,e-=i}return"form_total"===this.GFStripeObj.activeFeed.paymentAmount?(this.order.recurringAmount=e,this.isTextCoupon()&&(this.order.recurringAmount=this.applyStripeCoupon(this.order.recurringAmount))):(this.order.recurringAmount=gformCalculateProductPrice(t,this.GFStripeObj.activeFeed.paymentAmount),this.order.recurringAmount=this.applyStripeCoupon(this.order.recurringAmount)),this.order.paymentAmount="1"===n?i:this.order.recurringAmount+i,this.order}isTextCoupon(){const e=this.getStripeCouponInput();return!!e&&!e.classList.contains("gf_coupon_code")}isAjaxEmbed(e){return jQuery("#gform_ajax_frame_"+e).length>=1}}window.GFStripe=null,gform.extensions=gform.extensions||{},gform.extensions.styles=gform.extensions.styles||{},gform.extensions.styles.gravityformsstripe=gform.extensions.styles.gravityformsstripe||{},i=jQuery,GFStripe=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.form=null,this.activeFeed=null,this.GFCCField=null,this.stripeResponse=null,this.hasPaymentIntent=!1,this.stripePaymentHandlers={},this.cardStyle=this.cardStyle||{},gform.extensions.styles.gravityformsstripe[this.formId]=gform.extensions.styles.gravityformsstripe[this.formId]||{};const r=Object.keys(this.cardStyle).length>0?JSON.parse(JSON.stringify(this.cardStyle)):gform.extensions.styles.gravityformsstripe[this.formId][this.pageInstance]||{};this.setComponentStyleValue=function(e,t,r,i){let n="";if(0===t.indexOf("--")){const s=r.getPropertyValue(t);if(s)n=s;else{const t="fontSmoothing"===e?"-webkit-font-smoothing":e;n=(i?getComputedStyle(i):r).getPropertyValue(t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase())}}else n=t;return n.trim()},this.setComponentStyles=function(e,t,i){if(0===Object.keys(e).length)return;const n=document.getElementById("gform_"+this.formId),s=getComputedStyle(n),a=n.querySelector(".gfield input");Object.keys(e).forEach(n=>{if("object"!=typeof e[n]){if("object"!=typeof e[n]){let e="";i?t&&t!==i?(e=this.setComponentStyleValue(n,r[i][t][n],s,a),e&&(this.cardStyle[i][t][n]=e)):(e=this.setComponentStyleValue(n,r[i][n],s,a),e&&(this.cardStyle[i][n]=e)):(e=this.setComponentStyleValue(n,r[n],s,a),e&&(this.cardStyle[n]=e))}}else{i||(this.cardStyle[n]={}),i&&(this.cardStyle[i][n]={});const t=i||n;this.setComponentStyles(e[n],n,t)}})},this.init=async function(){if(this.setComponentStyles(r),this.isCreditCardOnPage()||"stripe.js"!==this.stripe_payment&&("elements"!==this.stripe_payment||i("#gf_stripe_response").length)){var e=this,t=null,n=!1,s=!1,o=this.apiKey;switch(this.form=i("#gform_"+this.formId),this.GFCCField=i("#input_"+this.formId+"_"+this.ccFieldId+"_1"),gform.addAction("gform_frontend_feeds_evaluated",(async function(r,c){if(c===e.formId){t=null,n=!1,s=!1;for(var u=0;u<Object.keys(r).length;u++)if("gravityformsstripe"===r[u].addonSlug&&r[u].isActivated){n=!0;for(var f=0;f<Object.keys(e.feeds).length;f++)if(e.feeds[f].feedId===r[u].feedId){t=e.feeds[f];break}if(o=t.hasOwnProperty("apiKey")?t.apiKey:e.apiKey,e.activeFeed=t,gformCalculateTotalPrice(c),"payment_element"==e.stripe_payment)e.stripePaymentHandlers[c]=new a(o,e);else if("elements"===e.stripe_payment)if(d=Stripe(o),l=d.elements(),s=""!==t.address_zip,null!=p&&p.hasOwnProperty("_destroyed")&&!1===p._destroyed&&p.destroy(),e.GFCCField.next(".validation_message").length&&e.GFCCField.next(".validation_message").remove(),p=l.create("card",{classes:e.cardClasses,style:e.cardStyle,hidePostalCode:s}),i(".gform_stripe_requires_action").length){2===i(".ginput_container_creditcard > div").length?(i(".ginput_container_creditcard > div:last").hide(),i(".ginput_container_creditcard > div:first").html("<p><strong>"+gforms_stripe_frontend_strings.requires_action+"</strong></p>")):i(".ginput_container_creditcard").html("<p><strong>"+gforms_stripe_frontend_strings.requires_action+"</strong></p>"),jQuery("#gform_"+c+"_validation_container h2 .gform_ajax_spinner").length<=0&&(jQuery("#gform_"+c+"_validation_container h2").append('<img id="gform_ajax_spinner_'+c+'"  class="gform_ajax_spinner" src="'+gf_global.spinnerUrl+'" alt="" />'),jQuery("#gform_submit_button_"+c).prop("disabled",!0));const t=jQuery("#gform_"+c+"_validation_container h2 .gform-icon.gform-icon--close"),r=jQuery(".gform-theme--framework").length;console.log(r),console.log(t),t.length&&!r&&t.removeClass("gform-icon--close").addClass("gform-icon--info"),e.scaActionHandler(d,c)}else p.mount("#"+e.GFCCField.attr("id")),p.on("change",(function(t){e.displayStripeCardError(t)}));else if("stripe.js"==e.stripe_payment){Stripe.setPublishableKey(o);break}break}n||("elements"!==e.stripe_payment&&"payment_element"!==e.stripe_payment||(null!=l&&p===l.getElement("card")&&p.destroy(),e.isStripePaymentHandlerInitiated(c)&&e.stripePaymentHandlers[c].destroy(),e.GFCCField.next(".validation_message").length||e.GFCCField.after('<div class="gfield_description validation_message gfield_validation_message">'+gforms_stripe_frontend_strings.no_active_frontend_feed+"</div>"),wp.a11y.speak(gforms_stripe_frontend_strings.no_active_frontend_feed)),e.resetStripeStatus(e.form,c,e.isLastPage()),o=e.apiKey,e.activeFeed=null)}})),gform.addFilter("gform_product_total",(function(t,r){if("payment_element"==e.stripe_payment&&e.isStripePaymentHandlerInitiated(r)&&e.stripePaymentHandlers[r].getOrderData(t,r),!e.activeFeed)return window["gform_stripe_amount_"+r]=0,t;if("form_total"!==e.activeFeed.paymentAmount){const t=e.getProductFieldPrice(r,e.activeFeed.paymentAmount);if(window["gform_stripe_amount_"+r]=t.price*t.qty,e.activeFeed.hasOwnProperty("setupFee")){const t=e.getProductFieldPrice(r,e.activeFeed.setupFee);window["gform_stripe_amount_"+r]+=t.price*t.qty}}else window["gform_stripe_amount_"+r]=t;return"payment_element"==e.stripe_payment&&e.isStripePaymentHandlerInitiated(r)&&null!==e.stripePaymentHandlers[r].elements&&"1"===gforms_stripe_frontend_strings.stripe_connect_enabled&&e.stripePaymentHandlers[r].updatePaymentAmount(e.stripePaymentHandlers[r].order.paymentAmount),t}),51),this.stripe_payment){case"elements":var d=null,l=null,p=null;i("#gf_stripe_response").length&&(this.stripeResponse=JSON.parse(i("#gf_stripe_response").val()),this.stripeResponse.hasOwnProperty("client_secret")&&(this.hasPaymentIntent=!0))}if(i("#gform_"+this.formId).on("submit",(function(r){let s=!1;const a=parseInt(i("#gform_source_page_number_"+e.formId).val(),10),o=parseInt(i("#gform_target_page_number_"+e.formId).val(),10);if(a>o&&0!==o&&(s=!0),!(s||!n||i(this).data("gfstripesubmitting")||1==i("#gform_save_"+e.formId).val()||!e.isLastPage()&&"elements"!==e.stripe_payment||gformIsHidden(e.GFCCField)||e.maybeHitRateLimits()||e.invisibleCaptchaPending()||e.recaptchav3Pending()||"payment_element"===e.stripe_payment&&0===window["gform_stripe_amount_"+e.formId]))switch(r.preventDefault(),i(this).data("gfstripesubmitting",!0),e.maybeAddSpinner(),e.stripe_payment){case"payment_element":e.injectHoneypot(r),e.stripePaymentHandlers[e.formId].validate(r);break;case"elements":if(e.form=i(this),e.isLastPage()&&!e.isCreditCardOnPage()||gformIsHidden(e.GFCCField)||s)return void i(this).submit();"product"===t.type?e.createPaymentMethod(d,p):e.createToken(d,p);break;case"stripe.js":var l=i(this),c="input_"+e.formId+"_"+e.ccFieldId+"_",u={number:l.find("#"+c+"1").val(),exp_month:l.find("#"+c+"2_month").val(),exp_year:l.find("#"+c+"2_year").val(),cvc:l.find("#"+c+"3").val(),name:l.find("#"+c+"5").val()};e.form=l,Stripe.card.createToken(u,(function(t,r){e.responseHandler(t,r)}))}})),"payment_element_intent_failure"in e&&e.payment_element_intent_failure){const t=jQuery('<div class="gform_validation_errors" id="gform_'+e.formId+'_validation_container" data-js="gform-focus-validation-error" tabindex="-1"><h2 class="gform_submission_error hide_summary"><span class="gform-icon gform-icon--close"></span>'+gforms_stripe_frontend_strings.payment_element_intent_failure+"</h2></div>");jQuery("#gform_wrapper_"+e.formId).prepend(t)}}},this.getProductFieldPrice=function(e,t){var r=GFMergeTag.getMergeTagValue(e,t,":price"),i=GFMergeTag.getMergeTagValue(e,t,":qty");return"string"==typeof r&&(r=GFMergeTag.getMergeTagValue(e,t+".2",":price"),i=GFMergeTag.getMergeTagValue(e,t+".3",":qty")),{price:r,qty:i}},this.getBillingAddressMergeTag=function(e){return""===e?"":"{:"+e+":value}"},this.responseHandler=function(e,t){for(var r=this.form,n="input_"+this.formId+"_"+this.ccFieldId+"_",s=["1","2_month","2_year","3","5"],a=0;a<s.length;a++){var o=r.find("#"+n+s[a]);if("1"==s[a]){var d=i.trim(o.val()),l=gformFindCardType(d);void 0!==this.cardLabels[l]&&(l=this.cardLabels[l]),r.append(i('<input type="hidden" name="stripe_credit_card_last_four" />').val(d.slice(-4))),r.append(i('<input type="hidden" name="stripe_credit_card_type" />').val(l))}}r.append(i('<input type="hidden" name="stripe_response" />').val(i.toJSON(t))),r.submit()},this.elementsResponseHandler=function(e){var t=this.form,r=this,n=this.activeFeed,s=gform.applyFilters("gform_stripe_currency",this.currency,this.formId),a=0===gf_global.gf_currency_config.decimals?window["gform_stripe_amount_"+this.formId]:gformRoundPrice(100*window["gform_stripe_amount_"+this.formId]);if(e.error)return this.displayStripeCardError(e),void this.resetStripeStatus(t,this.formId,this.isLastPage());if(this.hasPaymentIntent)if("product"===n.type)e.hasOwnProperty("paymentMethod")?(i("#gf_stripe_credit_card_last_four").val(e.paymentMethod.card.last4),i("#stripe_credit_card_type").val(e.paymentMethod.card.brand),i.ajax({async:!1,url:gforms_stripe_frontend_strings.ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_update_payment_intent",nonce:gforms_stripe_frontend_strings.create_payment_intent_nonce,payment_intent:e.id,payment_method:e.paymentMethod,currency:s,amount:a,feed_id:n.feedId},success:function(e){e.success?(i("#gf_stripe_response").val(i.toJSON(e.data)),t.submit()):(e.error=e.data,delete e.data,r.displayStripeCardError(e),r.resetStripeStatus(t,r.formId,r.isLastPage()))}})):e.hasOwnProperty("amount")&&t.submit();else{var o=JSON.parse(i("#gf_stripe_response").val());o.updatedToken=e.token.id,i("#gf_stripe_response").val(i.toJSON(o)),t.append(i('<input type="hidden" name="stripe_credit_card_last_four" id="gf_stripe_credit_card_last_four" />').val(e.token.card.last4)),t.append(i('<input type="hidden" name="stripe_credit_card_type" id="stripe_credit_card_type" />').val(e.token.card.brand)),t.submit()}else i("#gf_stripe_response").length?i("#gf_stripe_response").val(i.toJSON(e)):t.append(i('<input type="hidden" name="stripe_response" id="gf_stripe_response" />').val(i.toJSON(e))),"product"===n.type?(t.append(i('<input type="hidden" name="stripe_credit_card_last_four" id="gf_stripe_credit_card_last_four" />').val(e.paymentMethod.card.last4)),t.append(i('<input type="hidden" name="stripe_credit_card_type" id="stripe_credit_card_type" />').val(e.paymentMethod.card.brand)),i.ajax({async:!1,url:gforms_stripe_frontend_strings.ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_create_payment_intent",nonce:gforms_stripe_frontend_strings.create_payment_intent_nonce,payment_method:e.paymentMethod,currency:s,amount:a,feed_id:n.feedId},success:function(e){e.success?(i("#gf_stripe_response").length?i("#gf_stripe_response").val(i.toJSON(e.data)):t.append(i('<input type="hidden" name="stripe_response" id="gf_stripe_response" />').val(i.toJSON(e.data))),t.submit()):(e.error=e.data,delete e.data,r.displayStripeCardError(e),r.resetStripeStatus(t,r.formId,r.isLastPage()))}})):(t.append(i('<input type="hidden" name="stripe_credit_card_last_four" id="gf_stripe_credit_card_last_four" />').val(e.token.card.last4)),t.append(i('<input type="hidden" name="stripe_credit_card_type" id="stripe_credit_card_type" />').val(e.token.card.brand)),t.submit())},this.scaActionHandler=function(e,t){if(!i("#gform_"+t).data("gfstripescaauth")){i("#gform_"+t).data("gfstripescaauth",!0);var r=this,n=JSON.parse(i("#gf_stripe_response").val());"product"===this.activeFeed.type?e.retrievePaymentIntent(n.client_secret).then((function(s){"requires_action"===s.paymentIntent.status&&e.handleCardAction(n.client_secret).then((function(e){var n=JSON.parse(i("#gf_stripe_response").val());n.scaSuccess=!0,i("#gf_stripe_response").val(i.toJSON(n)),r.maybeAddSpinner(),jQuery("#gform_submit_button_"+t).prop("disabled",!1),i("#gform_"+t).data("gfstripescaauth",!1),i("#gform_"+t).data("gfstripesubmitting",!0).submit(),jQuery("#gform_submit_button_"+t).prop("disabled",!0)}))})):e.retrievePaymentIntent(n.client_secret).then((function(s){"requires_action"===s.paymentIntent.status&&e.handleCardPayment(n.client_secret).then((function(e){r.maybeAddSpinner(),jQuery("#gform_submit_button_"+t).prop("disabled",!1),i("#gform_"+t).data("gfstripescaauth",!1),i("#gform_"+t).data("gfstripesubmitting",!0).trigger("submit")}))}))}},this.isLastPage=function(){var e=i("#gform_target_page_number_"+this.formId);return!(e.length>0)||0==e.val()},this.isConversationalForm=function(){return i('[data-js="gform-conversational-form"]').length>0},this.isCreditCardOnPage=function(){var e=this.getCurrentPageNumber();return!(this.ccPage&&e&&!this.isConversationalForm())||this.ccPage==e},this.getCurrentPageNumber=function(){var e=i("#gform_source_page_number_"+this.formId);return e.length>0&&e.val()},this.maybeAddSpinner=function(){if(!this.isAjax)if("function"==typeof gformAddSpinner)gformAddSpinner(this.formId);else{var e=this.formId;if(0==jQuery("#gform_ajax_spinner_"+e).length){var t=gform.applyFilters("gform_spinner_url",gf_global.spinnerUrl,e);gform.applyFilters("gform_spinner_target_elem",jQuery("#gform_submit_button_"+e+", #gform_wrapper_"+e+" .gform_next_button, #gform_send_resume_link_button_"+e),e).after('<img id="gform_ajax_spinner_'+e+'"  class="gform_ajax_spinner" src="'+t+'" alt="" />')}}},this.resetStripeStatus=function(e,t,r){i("#gf_stripe_response, #gf_stripe_credit_card_last_four, #stripe_credit_card_type").remove(),e.data("gfstripesubmitting",!1),i("#gform_ajax_spinner_"+t).remove(),r&&(window["gf_submitting_"+t]=!1)},this.displayStripeCardError=function(e){e.error&&!this.GFCCField.next(".validation_message").length&&this.GFCCField.after('<div class="gfield_description validation_message gfield_validation_message"></div>');var t=this.GFCCField.next(".validation_message");e.error?(t.html(e.error.message),wp.a11y.speak(e.error.message,"assertive"),i("#gform_ajax_spinner_"+this.formId).length>0&&i("#gform_ajax_spinner_"+this.formId).remove()):t.remove()},this.createToken=function(e,t){const r=this,n=this.activeFeed,s={name:i("#input_"+r.formId+"_"+r.ccFieldId+"_5").val(),address_line1:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_line1)),address_line2:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_line2)),address_city:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_city)),address_state:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_state)),address_zip:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_zip)),address_country:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_country)),currency:gform.applyFilters("gform_stripe_currency",this.currency,this.formId)};e.createToken(t,s).then((function(e){r.elementsResponseHandler(e)}))},this.createPaymentMethod=function(e,t,r){var n=this,s=this.activeFeed,a="";if(""!==s.address_country&&(a=GFMergeTag.replaceMergeTags(n.formId,n.getBillingAddressMergeTag(s.address_country))),""===a||void 0!==r&&""!==r){var o=i("#input_"+this.formId+"_"+this.ccFieldId+"_5").val(),d=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_line1)),l=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_line2)),p=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_city)),c=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_state)),u=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_zip)),f={billing_details:{name:null,address:{}}};""!==o&&(f.billing_details.name=o),""!==d&&(f.billing_details.address.line1=d),""!==l&&(f.billing_details.address.line2=l),""!==p&&(f.billing_details.address.city=p),""!==c&&(f.billing_details.address.state=c),""!==u&&(f.billing_details.address.postal_code=u),""!==r&&(f.billing_details.address.country=r),null===f.billing_details.name&&delete f.billing_details.name,f.billing_details.address==={}&&delete f.billing_details.address,e.createPaymentMethod("card",t,f).then((function(e){null!==n.stripeResponse&&(e.id=n.stripeResponse.id,e.client_secret=n.stripeResponse.client_secret),n.elementsResponseHandler(e)}))}else i.ajax({async:!1,url:gforms_stripe_frontend_strings.ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_get_country_code",nonce:gforms_stripe_frontend_strings.create_payment_intent_nonce,country:a,feed_id:s.feedId},success:function(r){r.success&&n.createPaymentMethod(e,t,r.data.code)}})},this.maybeHitRateLimits=function(){return!!(this.hasOwnProperty("cardErrorCount")&&this.cardErrorCount>=5)},this.invisibleCaptchaPending=function(){var e=this.form.find(".ginput_recaptcha");if(!e.length||"invisible"!==e.data("size"))return!1;var t=e.find(".g-recaptcha-response");return!(t.length&&t.val())},this.recaptchav3Pending=function(){const e=this.form.find(".ginput_recaptchav3");if(!e.length)return!1;const t=e.find(".gfield_recaptcha_response");return!(t&&t.val())},this.injectHoneypot=e=>{const t=e.target;if((this.isFormSubmission(t)||this.isSaveContinue(t))&&!this.isHeadlessBrowser()){const e=`<input type="hidden" name="version_hash" value="${gf_global.version_hash}" />`;t.insertAdjacentHTML("beforeend",e)}},this.isSaveContinue=e=>{const t=e.dataset.formid,r=this.getNodes("#gform_save_"+t,!0,e,!0);return r.length>0&&"1"===r[0].value},this.isFormSubmission=e=>{const t=e.dataset.formid,r=this.getNodes(`input[name = "gform_target_page_number_${t}"]`,!0,e,!0)[0];return void 0!==r&&0===parseInt(r.value)},this.isHeadlessBrowser=()=>window._phantom||window.callPhantom||window.__phantomas||window.Buffer||window.emit||window.spawn||window.webdriver||window._selenium||window._Selenium_IDE_Recorder||window.callSelenium||window.__nightmare||window.domAutomation||window.domAutomationController||window.document.__webdriver_evaluate||window.document.__selenium_evaluate||window.document.__webdriver_script_function||window.document.__webdriver_script_func||window.document.__webdriver_script_fn||window.document.__fxdriver_evaluate||window.document.__driver_unwrapped||window.document.__webdriver_unwrapped||window.document.__driver_evaluate||window.document.__selenium_unwrapped||window.document.__fxdriver_unwrapped||window.document.documentElement.getAttribute("selenium")||window.document.documentElement.getAttribute("webdriver")||window.document.documentElement.getAttribute("driver"),this.getNodes=(e="",t=!1,r=document,i=!1)=>{const n=i?e:`[data-js="${e}"]`;let s=r.querySelectorAll(n);return t&&(s=this.convertElements(s)),s},this.convertElements=(e=[])=>{const t=[];let r=e.length;for(;r--;t.unshift(e[r]));return t},this.isStripePaymentHandlerInitiated=function(e){return e in this.stripePaymentHandlers&&null!==this.stripePaymentHandlers[e]&&void 0!==this.stripePaymentHandlers[e]},this.init()}}]);